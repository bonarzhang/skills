name: Auto close PRs

on:
  pull_request_target:
    types: [opened, reopened]

permissions:
  issues: write
  pull-requests: write

jobs:
  auto-close-pr:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/create-github-app-token@v1
        id: app-token
        with:
          app-id: "2729701"
          private-key: ${{ secrets.GH_APP_PRIVATE_KEY }}
      - name: Close PR as read-only mirror
        uses: actions/github-script@v7
        with:
          github-token: ${{ steps.app-token.outputs.token }}
          script: |
            const { owner, repo } = context.repo;
            const prNumber = context.payload.pull_request?.number;
            if (!prNumber) {
              return;
            }

            const message =
              "Thanks for the pull request! This repository is read-only and is automatically synced from https://clawhub.ai, so we canâ€™t accept changes here. Please make updates on the website instead.";

            await github.rest.issues.createComment({
              owner,
              repo,
              issue_number: prNumber,
              body: message,
            });

            await github.rest.pulls.update({
              owner,
              repo,
              pull_number: prNumber,
              state: "closed",
            });
